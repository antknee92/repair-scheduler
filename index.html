<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repair Scheduler - Team Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .connection-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            background: rgba(255,255,255,0.2);
        }

        .connection-status.connected {
            background: #28a745;
        }

        .connection-status.disconnected {
            background: #dc3545;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            margin-right: 5px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .time-block {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .time-block:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .time-block.available {
            border-color: #28a745;
            background: #d4edda;
        }

        .time-block.scheduled {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .time-block.in-progress {
            border-color: #17a2b8;
            background: #d1ecf1;
        }

        .time-block.completed {
            border-color: #6c757d;
            background: #e2e3e5;
        }

        .time-block h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .time-block p {
            margin: 5px 0;
            color: #6c757d;
            font-size: 14px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-scheduled {
            background: #ffc107;
            color: #000;
        }

        .status-in-progress {
            background: #17a2b8;
            color: white;
        }

        .status-completed {
            background: #28a745;
            color: white;
        }

        .priority-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            margin-left: 5px;
        }

        .priority-P1 {
            background: #dc3545;
            color: white;
        }

        .priority-P2 {
            background: #ffc107;
            color: #000;
        }

        .priority-P3 {
            background: #28a745;
            color: white;
        }

        .time-block.priority-p1 {
            border-left: 5px solid #dc3545;
        }

        .time-block.priority-p2 {
            border-left: 5px solid #ffc107;
        }

        .time-block.priority-p3 {
            border-left: 5px solid #28a745;
        }

        .notification {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification.urgent {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h2 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .repairs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .repairs-table th,
        .repairs-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .repairs-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .repairs-table tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .schedule-grid {
                grid-template-columns: 1fr;
            }
        }

        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .setup-panel {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 30px;
            margin: 20px;
            text-align: center;
        }

        .setup-panel h2 {
            color: #856404;
            margin-bottom: 15px;
        }

        .setup-panel p {
            color: #856404;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .setup-panel code {
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Repair Scheduler - Team Edition</h1>
            <p>Manage repairs, track progress, and optimize your workflow</p>
            <div class="connection-status" id="connectionStatus">‚öôÔ∏è Initializing...</div>
        </div>

        <!-- Setup Instructions Panel (shown if Firebase not configured) -->
        <div id="setupPanel" class="setup-panel" style="display: none;">
            <h2>üöÄ Almost Ready!</h2>
            <p>To enable real-time team collaboration, you need to add your Firebase configuration.</p>
            <p><strong>Follow these steps:</strong></p>
            <ol style="text-align: left; max-width: 600px; margin: 20px auto;">
                <li>Go to <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                <li>Create a new project (or use existing one)</li>
                <li>Add a web app to your project</li>
                <li>Copy the Firebase config object</li>
                <li>Paste it in the <code>firebaseConfig</code> section of this HTML file (line ~40)</li>
                <li>Enable Firestore Database in Firebase Console</li>
                <li>Set security rules to allow read/write for testing</li>
            </ol>
            <p style="margin-top: 20px;"><em>Need help? I'll provide detailed instructions after we finish setup!</em></p>
        </div>

        <div id="mainApp" style="display: none;">
            <div class="tabs">
                <button class="tab active" onclick="showTab('schedule')">üìÖ Schedule</button>
                <button class="tab" onclick="showTab('repairs')">üõ†Ô∏è Repairs</button>
                <button class="tab" onclick="showTab('notifications')">üîî Notifications</button>
                <button class="tab" onclick="showTab('reports')">üìä Reports</button>
            </div>

            <!-- Schedule Tab -->
            <div id="schedule" class="tab-content active">
                <h2 style="margin-bottom: 20px;">Create New Time Block</h2>
                <form id="timeBlockForm" onsubmit="addTimeBlock(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blockDate">Date</label>
                            <input type="date" id="blockDate" required>
                        </div>
                        <div class="form-group">
                            <label for="blockDuration">Duration (hours)</label>
                            <input type="number" id="blockDuration" min="0.5" step="0.5" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blockStartTime">Start Time</label>
                            <input type="time" id="blockStartTime" required>
                        </div>
                        <div class="form-group">
                            <label for="blockEndTime">End Time</label>
                            <input type="time" id="blockEndTime" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Time Block</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">Available Time Blocks</h2>
                <div id="timeBlocksList" class="schedule-grid"></div>
            </div>

            <!-- Repairs Tab -->
            <div id="repairs" class="tab-content">
                <h2 style="margin-bottom: 20px;">Schedule New Repair</h2>
                <form id="repairForm" onsubmit="addRepair(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="componentType">Component Type</label>
                            <select id="componentType" required>
                                <option value="">Select a component...</option>
                                <option value="Main Logic Board">Main Logic Board</option>
                                <option value="Display">Display</option>
                                <option value="I/O Board">I/O Board</option>
                                <option value="Magsafe Board">Magsafe Board</option>
                                <option value="Audio Board">Audio Board</option>
                                <option value="Topcase">Topcase</option>
                                <option value="Bottomcase">Bottomcase</option>
                                <option value="Battery">Battery</option>
                                <option value="Speakers">Speakers</option>
                                <option value="Fans">Fans</option>
                                <option value="USB-C Board">USB-C Board</option>
                                <option value="Touch ID">Touch ID</option>
                                <option value="Lid Angle Sensor">Lid Angle Sensor</option>
                                <option value="Power Supply">Power Supply</option>
                                <option value="Vent Module">Vent Module</option>
                                <option value="Trackpad">Trackpad</option>
                                <option value="Keycap">Keycap</option>
                                <option value="HDD">HDD</option>
                                <option value="SSD">SSD</option>
                                <option value="Deep Dive">Deep Dive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="priority">Priority Level</label>
                            <select id="priority" required>
                                <option value="">Select priority...</option>
                                <option value="P1">P1 - High Priority</option>
                                <option value="P2">P2 - Medium Priority</option>
                                <option value="P3">P3 - Low Priority</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testingNeeded">Testing Needed</label>
                            <input type="text" id="testingNeeded" placeholder="e.g., Pressure test, Visual inspection" required>
                        </div>
                        <div class="form-group">
                            <label for="estimatedTime">Estimated Time (hours)</label>
                            <input type="number" id="estimatedTime" min="0.5" step="0.5" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assignedBlock">Assign to Time Block</label>
                            <select id="assignedBlock" required>
                                <option value="">Select a time block...</option>
                            </select>
                        </div>
                        <div></div>
                    </div>
                    <div class="form-group">
                        <label for="repairNotes">Notes</label>
                        <textarea id="repairNotes" rows="3" placeholder="Additional details about the repair..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Schedule Repair</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">All Repairs</h2>
                <div style="margin-bottom: 15px;">
                    <label for="priorityFilter" style="margin-right: 10px; font-weight: 600;">Filter by Priority:</label>
                    <select id="priorityFilter" onchange="renderRepairs()" style="padding: 8px; border: 2px solid #e9ecef; border-radius: 8px;">
                        <option value="all">All Priorities</option>
                        <option value="P1">P1 - High Priority</option>
                        <option value="P2">P2 - Medium Priority</option>
                        <option value="P3">P3 - Low Priority</option>
                    </select>
                    <label for="sortBy" style="margin-left: 20px; margin-right: 10px; font-weight: 600;">Sort by:</label>
                    <select id="sortBy" onchange="renderRepairs()" style="padding: 8px; border: 2px solid #e9ecef; border-radius: 8px;">
                        <option value="priority">Priority (P1 first)</option>
                        <option value="date">Date</option>
                        <option value="status">Status</option>
                        <option value="component">Component</option>
                    </select>
                </div>
                <div id="repairsList"></div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications" class="tab-content">
                <h2 style="margin-bottom: 20px;">Notifications & Reminders</h2>
                <div id="notificationsList"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2 style="margin-bottom: 20px;">Reports & Statistics</h2>
                <div class="stats-grid" id="statsGrid"></div>
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Repair History</h3>
                <table class="repairs-table" id="reportsTable"></table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
        // TODO: Replace with your Firebase configuration
        // Get this from Firebase Console > Project Settings > Your apps > SDK setup and configuration
        const firebaseConfig = {

          apiKey: "AIzaSyCilOnF7_RCEVM7ule8kpA-c4uybZhnq60",

          authDomain: "mac-repair-scheduler.firebaseapp.com",

          projectId: "mac-repair-scheduler",

          storageBucket: "mac-repair-scheduler.firebasestorage.app",

          messagingSenderId: "268040834597",

          appId: "1:268040834597:web:8158094373ee6c0d9679cc"

        };


        // Check if Firebase is configured
        const isConfigured = firebaseConfig.apiKey !== "AIzaSyCilOnF7_RCEVM7ule8kpA-c4uybZhnq60";
        
        if (!isConfigured) {
            document.getElementById('setupPanel').style.display = 'block';
            document.getElementById('connectionStatus').textContent = '‚ö†Ô∏è Configuration Required';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
        } else {
            document.getElementById('mainApp').style.display = 'block';
            
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Global data
            window.timeBlocks = [];
            window.repairs = [];
            window.db = db;

            // Component time estimates (in hours)
            const componentTimeEstimates = {
                'Main Logic Board': 1.5,
                'Display': 0.75,
                'I/O Board': 1,
                'Magsafe Board': 1,
                'Audio Board': 1,
                'Topcase': 2.5,
                'Bottomcase': 0.25,
                'Battery': 2.5,
                'Speakers': 0.75,
                'Fans': 0.75,
                'USB-C Board': 1,
                'Touch ID': 0.75,
                'Lid Angle Sensor': 0.75,
                'Power Supply': 1,
                'Vent Module': 0.75,
                'Trackpad': 0.75,
                'Keycap': 0.25,
                'HDD': 1,
                'SSD': 1,
                'Deep Dive': 2
            };

            // Load data from Firebase
            async function loadData() {
                try {
                    // Load time blocks
                    const blocksSnapshot = await getDocs(collection(db, 'timeBlocks'));
                    window.timeBlocks = blocksSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    // Load repairs
                    const repairsSnapshot = await getDocs(collection(db, 'repairs'));
                    window.repairs = repairsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    document.getElementById('connectionStatus').textContent = '‚úÖ Connected';
                    document.getElementById('connectionStatus').className = 'connection-status connected';

                    renderTimeBlocks();
                    renderRepairs();
                    updateAvailableBlocks();
                    renderNotifications();
                    renderReports();
                } catch (error) {
                    console.error('Error loading data:', error);
                    document.getElementById('connectionStatus').textContent = '‚ùå Connection Error';
                    document.getElementById('connectionStatus').className = 'connection-status disconnected';
                }
            }

            // Set up real-time listeners
            function setupRealtimeListeners() {
                // Listen to time blocks
                onSnapshot(collection(db, 'timeBlocks'), (snapshot) => {
                    window.timeBlocks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderTimeBlocks();
                    updateAvailableBlocks();
                });

                // Listen to repairs
                onSnapshot(collection(db, 'repairs'), (snapshot) => {
                    window.repairs = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderRepairs();
                    renderNotifications();
                    renderReports();
                });
            }

            // Initialize
            async function init() {
                await loadData();
                setupRealtimeListeners();
                
                // Add event listener for component selection
                document.getElementById('componentType').addEventListener('change', function() {
                    const selectedComponent = this.value;
                    const estimatedTimeInput = document.getElementById('estimatedTime');
                    
                    if (selectedComponent && componentTimeEstimates[selectedComponent]) {
                        estimatedTimeInput.value = componentTimeEstimates[selectedComponent];
                        estimatedTimeInput.readOnly = true;
                        estimatedTimeInput.style.backgroundColor = '#e9ecef';
                        estimatedTimeInput.style.cursor = 'not-allowed';
                    } else {
                        estimatedTimeInput.value = '';
                        estimatedTimeInput.readOnly = false;
                        estimatedTimeInput.style.backgroundColor = 'white';
                        estimatedTimeInput.style.cursor = 'text';
                    }
                });
            }

            // Add time block
            window.addTimeBlock = async function(event) {
                event.preventDefault();
                
                const block = {
                    date: document.getElementById('blockDate').value,
                    startTime: document.getElementById('blockStartTime').value,
                    endTime: document.getElementById('blockEndTime').value,
                    duration: parseFloat(document.getElementById('blockDuration').value),
                    status: 'available',
                    createdAt: new Date().toISOString()
                };
                
                try {
                    await addDoc(collection(db, 'timeBlocks'), block);
                    document.getElementById('timeBlockForm').reset();
                    alert('Time block created successfully!');
                } catch (error) {
                    console.error('Error adding time block:', error);
                    alert('Error creating time block. Please try again.');
                }
            };

            // Add repair
            window.addRepair = async function(event) {
                event.preventDefault();
                
                const blockId = document.getElementById('assignedBlock').value;
                const block = window.timeBlocks.find(b => b.id === blockId);
                
                if (!block) {
                    alert('Please select a valid time block');
                    return;
                }
                
                const repair = {
                    componentType: document.getElementById('componentType').value,
                    priority: document.getElementById('priority').value,
                    testingNeeded: document.getElementById('testingNeeded').value,
                    estimatedTime: parseFloat(document.getElementById('estimatedTime').value),
                    blockId: blockId,
                    notes: document.getElementById('repairNotes').value,
                    status: 'scheduled',
                    createdAt: new Date().toISOString()
                };
                
                try {
                    // Add repair
                    await addDoc(collection(db, 'repairs'), repair);
                    
                    // Update block status
                    await updateDoc(doc(db, 'timeBlocks', blockId), {
                        status: 'scheduled',
                        priority: repair.priority
                    });
                    
                    document.getElementById('repairForm').reset();
                    alert('Repair scheduled successfully!');
                } catch (error) {
                    console.error('Error scheduling repair:', error);
                    alert('Error scheduling repair. Please try again.');
                }
            };

            // Update repair status
            window.updateRepairStatus = async function(repairId, newStatus) {
                const repair = window.repairs.find(r => r.id === repairId);
                if (!repair) return;
                
                try {
                    await updateDoc(doc(db, 'repairs', repairId), {
                        status: newStatus
                    });
                    
                    // Update block status
                    await updateDoc(doc(db, 'timeBlocks', repair.blockId), {
                        status: newStatus
                    });
                } catch (error) {
                    console.error('Error updating repair status:', error);
                    alert('Error updating status. Please try again.');
                }
            };

            // Delete repair
            window.deleteRepair = async function(repairId) {
                if (!confirm('Are you sure you want to delete this repair?')) return;
                
                const repair = window.repairs.find(r => r.id === repairId);
                if (!repair) return;
                
                try {
                    await deleteDoc(doc(db, 'repairs', repairId));
                    
                    // Update block status to available
                    await updateDoc(doc(db, 'timeBlocks', repair.blockId), {
                        status: 'available',
                        priority: null
                    });
                } catch (error) {
                    console.error('Error deleting repair:', error);
                    alert('Error deleting repair. Please try again.');
                }
            };

            // Render functions (same as before)
            window.renderTimeBlocks = function() {
                const container = document.getElementById('timeBlocksList');
                
                if (window.timeBlocks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <h3>No time blocks yet</h3>
                            <p>Create your first time block to start scheduling repairs</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = window.timeBlocks.map(block => {
                    const repair = window.repairs.find(r => r.blockId === block.id);
                    const statusClass = block.status || 'available';
                    const priorityClass = block.priority ? `priority-${block.priority.toLowerCase()}` : '';
                    
                    return `
                        <div class="time-block ${statusClass} ${priorityClass}">
                            <h3>üìÖ ${formatDate(block.date)}</h3>
                            <p><strong>Time:</strong> ${block.startTime} - ${block.endTime}</p>
                            <p><strong>Duration:</strong> ${block.duration} hours</p>
                            ${repair ? `
                                <p><strong>Component:</strong> ${repair.componentType}</p>
                                <p><strong>Testing:</strong> ${repair.testingNeeded}</p>
                            ` : ''}
                            <span class="status-badge status-${statusClass}">${statusClass.toUpperCase().replace('-', ' ')}</span>
                            ${repair && repair.priority ? `<span class="priority-badge priority-${repair.priority}">${repair.priority}</span>` : ''}
                        </div>
                    `;
                }).join('');
            };

            window.renderRepairs = function() {
                const container = document.getElementById('repairsList');
                
                if (window.repairs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <h3>No repairs scheduled</h3>
                            <p>Schedule your first repair to get started</p>
                        </div>
                    `;
                    return;
                }
                
                const priorityFilter = document.getElementById('priorityFilter')?.value || 'all';
                const sortBy = document.getElementById('sortBy')?.value || 'priority';
                
                let filteredRepairs = window.repairs;
                if (priorityFilter !== 'all') {
                    filteredRepairs = window.repairs.filter(r => r.priority === priorityFilter);
                }
                
                filteredRepairs = [...filteredRepairs].sort((a, b) => {
                    if (sortBy === 'priority') {
                        const priorityOrder = { 'P1': 1, 'P2': 2, 'P3': 3 };
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    } else if (sortBy === 'date') {
                        const blockA = window.timeBlocks.find(bl => bl.id === a.blockId);
                        const blockB = window.timeBlocks.find(bl => bl.id === b.blockId);
                        if (!blockA || !blockB) return 0;
                        return new Date(blockA.date) - new Date(blockB.date);
                    } else if (sortBy === 'status') {
                        const statusOrder = { 'scheduled': 1, 'in-progress': 2, 'completed': 3 };
                        return statusOrder[a.status] - statusOrder[b.status];
                    } else if (sortBy === 'component') {
                        return a.componentType.localeCompare(b.componentType);
                    }
                    return 0;
                });
                
                container.innerHTML = filteredRepairs.map(repair => {
                    const block = window.timeBlocks.find(b => b.id === repair.blockId);
                    const priorityClass = `priority-${repair.priority.toLowerCase()}`;
                    
                    return `
                        <div class="time-block ${repair.status} ${priorityClass}">
                            <h3>üîß ${repair.componentType}</h3>
                            <p><strong>Testing:</strong> ${repair.testingNeeded}</p>
                            <p><strong>Estimated Time:</strong> ${repair.estimatedTime} hours</p>
                            ${block ? `<p><strong>Scheduled:</strong> ${formatDate(block.date)} at ${block.startTime}</p>` : ''}
                            ${repair.notes ? `<p><strong>Notes:</strong> ${repair.notes}</p>` : ''}
                            <span class="status-badge status-${repair.status}">${repair.status.toUpperCase().replace('-', ' ')}</span>
                            <span class="priority-badge priority-${repair.priority}">${repair.priority}</span>
                            <div class="action-buttons">
                                ${repair.status === 'scheduled' ? `
                                    <button class="btn btn-warning btn-small" onclick="updateRepairStatus('${repair.id}', 'in-progress')">Start</button>
                                ` : ''}
                                ${repair.status === 'in-progress' ? `
                                    <button class="btn btn-success btn-small" onclick="updateRepairStatus('${repair.id}', 'completed')">Complete</button>
                                ` : ''}
                                <button class="btn btn-danger btn-small" onclick="deleteRepair('${repair.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                }).join('');
            };

            window.updateAvailableBlocks = function() {
                const select = document.getElementById('assignedBlock');
                const availableBlocks = window.timeBlocks.filter(b => b.status === 'available');
                
                select.innerHTML = '<option value="">Select a time block...</option>' +
                    availableBlocks.map(block => 
                        `<option value="${block.id}">${formatDate(block.date)} | ${block.startTime} - ${block.endTime} (${block.duration}h)</option>`
                    ).join('');
            };

            window.renderNotifications = function() {
                const container = document.getElementById('notificationsList');
                const notifications = [];
                
                window.repairs.forEach(repair => {
                    if (repair.priority === 'P1' && (repair.status === 'scheduled' || repair.status === 'in-progress')) {
                        const block = window.timeBlocks.find(b => b.id === repair.blockId);
                        if (block) {
                            const status = repair.status === 'in-progress' ? 'IN PROGRESS' : 'scheduled';
                            notifications.push({
                                type: 'urgent',
                                message: `üî¥ P1 Priority: ${repair.componentType} ${status} for ${formatDate(block.date)} at ${block.startTime}`,
                                id: repair.id
                            });
                        }
                    }
                });
                
                const now = new Date();
                const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                
                window.repairs.forEach(repair => {
                    if (repair.status === 'scheduled' && repair.priority !== 'P1') {
                        const block = window.timeBlocks.find(b => b.id === repair.blockId);
                        if (block) {
                            const repairDate = new Date(block.date + 'T' + block.startTime);
                            
                            if (repairDate <= tomorrow && repairDate >= now) {
                                const priorityIcon = repair.priority === 'P2' ? 'üü°' : 'üü¢';
                                notifications.push({
                                    type: repair.priority === 'P2' ? 'urgent' : 'normal',
                                    message: `${priorityIcon} ${repair.priority}: ${repair.componentType} scheduled for ${formatDate(block.date)} at ${block.startTime}`,
                                    id: repair.id
                                });
                            }
                        }
                    }
                });
                
                window.repairs.filter(r => r.status === 'in-progress' && r.priority !== 'P1').forEach(repair => {
                    const block = window.timeBlocks.find(b => b.id === repair.blockId);
                    if (block) {
                        const priorityIcon = repair.priority === 'P2' ? 'üü°' : 'üü¢';
                        notifications.push({
                            type: 'normal',
                            message: `${priorityIcon} ${repair.priority}: ${repair.componentType} - ${repair.testingNeeded} (In Progress)`,
                            id: repair.id
                        });
                    }
                });
                
                if (notifications.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                            <h3>No notifications</h3>
                            <p>You're all caught up!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = notifications.map(notif => `
                    <div class="notification ${notif.type === 'urgent' ? 'urgent' : ''}">
                        <div>
                            <strong>${notif.type === 'urgent' ? '‚ö†Ô∏è Urgent' : 'üîî Notification'}</strong>
                            <p style="margin-top: 5px;">${notif.message}</p>
                        </div>
                    </div>
                `).join('');
            };

            window.renderReports = function() {
                const scheduled = window.repairs.filter(r => r.status === 'scheduled').length;
                const inProgress = window.repairs.filter(r => r.status === 'in-progress').length;
                const completed = window.repairs.filter(r => r.status === 'completed').length;
                const total = window.repairs.length;
                
                document.getElementById('statsGrid').innerHTML = `
                    <div class="stat-card">
                        <h2>${total}</h2>
                        <p>Total Repairs</p>
                    </div>
                    <div class="stat-card">
                        <h2>${scheduled}</h2>
                        <p>Scheduled</p>
                    </div>
                    <div class="stat-card">
                        <h2>${inProgress}</h2>
                        <p>In Progress</p>
                    </div>
                    <div class="stat-card">
                        <h2>${completed}</h2>
                        <p>Completed</p>
                    </div>
                `;
                
                const table = document.getElementById('reportsTable');
                if (window.repairs.length === 0) {
                    table.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">No repair history available</td></tr>';
                    return;
                }
                
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Priority</th>
                            <th>Component</th>
                            <th>Testing</th>
                            <th>Time</th>
                            <th>Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${window.repairs.map(repair => {
                            const block = window.timeBlocks.find(b => b.id === repair.blockId);
                            return `
                                <tr>
                                    <td><span class="priority-badge priority-${repair.priority}">${repair.priority}</span></td>
                                    <td>${repair.componentType}</td>
                                    <td>${repair.testingNeeded}</td>
                                    <td>${repair.estimatedTime}h</td>
                                    <td>${block ? formatDate(block.date) : 'N/A'}</td>
                                    <td><span class="status-badge status-${repair.status}">${repair.status.replace('-', ' ').toUpperCase()}</span></td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                `;
            };

            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
            }

            window.showTab = function(tabName) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById(tabName).classList.add('active');
                
                if (tabName === 'reports') {
                    renderReports();
                }
                if (tabName === 'notifications') {
                    renderNotifications();
                }
            };

            // Initialize the app
            init();
        }
    </script>
</body>
</html>
